<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_angular_provider">
    <sp_angular_provider action="INSERT_OR_UPDATE">
        <name>ngAbeImageVar</name>
        <script><![CDATA[function ngAbeImageVarCtrl($http) {

    function link(scope, elem) {

        scope.trigger = trigger;
        scope.change = change;

        scope.addLoadProcessor(function (val) {
            return val.substring(1, val.length - 1);
        });

        scope.addSaveProcessor(function (val) {
            return "'" + val + "'";
        });

        scope.init();

        function change(files) {

            let ext = '.' + files[0].name.split('.').pop();
            let name = scope.vbl.sassVar + '-' + Date.now() + ext;

            $http({
                method: 'POST',
                url: '/api/now/table/db_image',
                data: {
                    'name': name
                }
            }).then(function (r) {

                let sysId = r.data.result.sys_id;

                $http({
                    method: 'POST',
                    url: '/api/now/attachment/file',
                    params: {
                        'table_name': 'db_image',
                        'file_name': 'image',
                        'table_sys_id': sysId
                    },
                    headers: {
                        'Content-Type': files[0].type
                    },
                    data: files[0]
                }).then(function () {
                    scope.value = name;
                    scope.save(scope.vbl.sassVar, scope.value);
                });

            });

        }

        function trigger() {
            elem.find('#uploadElem').click();
        }

    }


    return {
        templateUrl: 'ng-abe-image',
        require: '^^ngAbeVariable',
        link: link
    };
}]]></script>
        <sys_class_name>sp_angular_provider</sys_class_name>
        <sys_created_by>dylan.lindgren</sys_created_by>
        <sys_created_on>2018-12-21 00:23:40</sys_created_on>
        <sys_id>f4719ff8db2e23403efe6f048a961994</sys_id>
        <sys_mod_count>35</sys_mod_count>
        <sys_name>ngAbeImageVar</sys_name>
        <sys_package display_value="Advanced Branding Editor" source="x_si_abe">d5e53253db21230022757d9ebf9619b4</sys_package>
        <sys_policy/>
        <sys_scope display_value="Advanced Branding Editor">d5e53253db21230022757d9ebf9619b4</sys_scope>
        <sys_update_name>sp_angular_provider_f4719ff8db2e23403efe6f048a961994</sys_update_name>
        <sys_updated_by>dylan.lindgren</sys_updated_by>
        <sys_updated_on>2018-12-26 22:38:35</sys_updated_on>
        <type>directive</type>
    </sp_angular_provider>
</record_update>
