<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_angular_provider">
    <sp_angular_provider action="INSERT_OR_UPDATE">
        <name>ngAbeVariableImage</name>
        <script><![CDATA[function ngAbeVariableImage($http) {

    function ngAbeVariableImageCtrl () {}

    function ngAbeVariableImageLink(scope, elem, attr, ctrl) {

        ctrl[0].value = ctrl[0].value.replace(/['"]+/g, '');

        scope.stageValue = ctrl[0].value;

        ctrl[0].saveProcessor = function (val) {
            ctrl[1].saveProcessor("'" + val + "'");
        };

        scope.trigger = trigger;
        scope.change = change;

        function change(files) {

            let ext = '.' + files[0].name.split('.').pop();
            let name = scope.item.sassVariable + '-' + Date.now() + ext;

            $http({
                method: 'POST',
                url: '/api/now/table/db_image',
                data: {
                    'name': name
                }
            }).then(function (r) {

                let sysId = r.data.result.sys_id;

                $http({
                    method: 'POST',
                    url: '/api/now/attachment/file',
                    params: {
                        'table_name': 'db_image',
                        'file_name': 'image',
                        'table_sys_id': sysId
                    },
                    headers: {
                        'Content-Type': files[0].type
                    },
                    data: files[0]
                }).then(function () {
                    scope.save(name);
                    scope.stageValue = name;
                });

            });

        }

        function trigger() {
            elem.find('#uploadElem').click();
        }
    }

    return {
        templateUrl: 'ng-abe-variable-image',
        require: ['^^ngAbeItem', '^^ngAbeVariable'],
        link: ngAbeVariableImageLink,
        controller: ngAbeVariableImageCtrl
    };
}]]></script>
        <sys_class_name>sp_angular_provider</sys_class_name>
        <sys_created_by>dylan.lindgren</sys_created_by>
        <sys_created_on>2018-12-21 00:23:40</sys_created_on>
        <sys_id>f4719ff8db2e23403efe6f048a961994</sys_id>
        <sys_mod_count>84</sys_mod_count>
        <sys_name>ngAbeVariableImage</sys_name>
        <sys_package display_value="Advanced Branding Editor" source="x_si_abe">d5e53253db21230022757d9ebf9619b4</sys_package>
        <sys_policy/>
        <sys_scope display_value="Advanced Branding Editor">d5e53253db21230022757d9ebf9619b4</sys_scope>
        <sys_update_name>sp_angular_provider_f4719ff8db2e23403efe6f048a961994</sys_update_name>
        <sys_updated_by>dylan.lindgren</sys_updated_by>
        <sys_updated_on>2019-01-08 00:13:33</sys_updated_on>
        <type>directive</type>
    </sp_angular_provider>
</record_update>
