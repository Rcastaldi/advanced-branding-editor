<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_angular_provider">
    <sp_angular_provider action="INSERT_OR_UPDATE">
        <name>ngAbeFieldImage</name>
        <script><![CDATA[function ngAbeFieldImage ($http, $rootScope, NgAbeTransport) {

	function ngAbeFieldImageLink (scope, elem, attr, ctrl) {

		scope.trigger = trigger;
		scope.change = change;

		let table = scope.item.table;
		let fileName = scope.item.field;
		let document = scope.item.document;

		$http({
			method: 'GET',
			url: '/api/now/table/sys_attachment',
			params: {
				'sysparm_query':
					'table_name=ZZ_YY' + table + '^file_name=' + fileName + '^table_sys_id=' + document

			}
		}).then(function (r) {



		});

		function trigger() {
			elem.find('#uploadElem').click();
		}

		function change(files) {

			$rootScope.$broadcast('abe.save.start');
			
			$http({
				method: 'POST',
				url: '/api/now/attachment/file',
				params: {
					'table_sys_id': document,
					'table_name' : table,
					'file_name': fileName
				},
				headers: {
					'Content-Type': files[0].type
				},
				data: files[0]
			}).then(function (r) {

				$http({
					method: 'PUT',
					url: '/api/now/table/sys_attachment/' + r.data.result.sys_id,
					data: {
						'table_name': 'ZZ_YY' + table
					}
				});
			}).then(function () {
				$rootScope.$broadcast('abe.save.complete');
			});
		}

		ctrl[0].saveProcessor = function () {
			return null;
		};

	}

	function ngAbeFieldImageCtrl ($scope) {
		$scope.stageValue = $scope.value;

		$scope.change = function () {
			$scope.save($scope.stageValue);
		};
	}

	return {
		templateUrl: 'ng-abe-field-image',
		require: ['^^ngAbeItem', '^^ngAbeField'],
		controller: ngAbeFieldImageCtrl,
		link: ngAbeFieldImageLink
	};
}]]></script>
        <sys_class_name>sp_angular_provider</sys_class_name>
        <sys_created_by>dylan.lindgren</sys_created_by>
        <sys_created_on>2019-01-04 01:38:05</sys_created_on>
        <sys_id>05a8a3d5dbba670027fb8a8b3a9619da</sys_id>
        <sys_mod_count>80</sys_mod_count>
        <sys_name>ngAbeFieldImage</sys_name>
        <sys_package display_value="Advanced Branding Editor" source="x_si_abe">d5e53253db21230022757d9ebf9619b4</sys_package>
        <sys_policy/>
        <sys_scope display_value="Advanced Branding Editor">d5e53253db21230022757d9ebf9619b4</sys_scope>
        <sys_update_name>sp_angular_provider_05a8a3d5dbba670027fb8a8b3a9619da</sys_update_name>
        <sys_updated_by>dylan.lindgren</sys_updated_by>
        <sys_updated_on>2019-01-07 04:09:20</sys_updated_on>
        <type>directive</type>
    </sp_angular_provider>
</record_update>
